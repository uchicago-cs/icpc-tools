-------------------------------------------------------------------------------
                      PC^2 scoreboard publishing script

                         (c) 2014, Borja Sotomayor
-------------------------------------------------------------------------------

This script takes scoreboard files generated by PC^2 and publishes them to 
a public website. It will also handle the freezing of the scoreboard at a 
specific time.

It assumes that the web server where the scoreboards will be published is
a UNIX server, and that the user running this script has SSH access to that
server (with a password-less SSH key)

COMMAND-LINE OPTIONS
--------------------

The script has a single mandatory argument: a configuration file. See the file 
"contest.conf.sample" for a description of every option.

Additionally, the script has the following optional arguments:

 --verbose
     Produce verbose output

 --freeze

     Publish a frozen scoreboard. For the static HTML files, this just involves
     adding a "The scoreboard is frozen" message at the top of the scoreboard.

     If using EWTeam, this will replace the dynamically-generated scoreboard 
     with a static snapshot of the scoreboard.

 --thaw-ewteam

     Besides publishing the static HTML files, also thaw the EWTeam scoreboard 
     (use this option only after a freeze)

 --suffix SUFFIX

     Publish the static HTML files with a suffix at the end of the filename. 
     For example, if SUFFIX is "final", "summary.html" becomes 
     "summary-final.html"

     This option is useful when using the same website for multiple contests 
     over time. The default filenames can be used when a contest is in 
     progress, and the final scoreboard can be saved with a different name for
     posterity.

     This option is also useful to make the scoreboard available only to a few
     people after the scoreboard freeze (by using a secret suffix that only
     those persons know)

 --update N

     By default, the script will publish the scoreboard and exit. This option 
     keeps the script running indefinitely, and updates the scoreboard at least
     every N seconds. If the scoreboard has not changed since the last update, 
     nothing is uploaded to the web server.

     If --freeze-at is specified, the script will stop running after the frozen 
     scoreboard is published.

     Note: N is actually the number of seconds the script will sleep between 
     updates. So, if uploading the files takes a few seconds, the frequency of 
     updates may be a bit over N.

 --freeze-at DATE

     Freeze the scoreboard at DATE. This option requires option --update

     The date must be specified as:

       YYYY-MM-DD HH:MM

     e.g., 2014-11-01 17:30

     This time is assumed to be in the same timezone as the machine where the 
     script is running.


USAGE
-----

A common way of using this script would be as follows:

1. At the start of the contest, run this to upload the scoreboard to the web
   server every 10 seconds, and specifying that the scoreboard should be frozen
   at 16:30 of November 1st, 2014.

      python scoreboard-publish.py contest.conf --update 10 --freeze-at "2014-11-01 16:30"

2. After the freeze, if it is desirable to share the scoreboard with a select
   group of users, select a "suffix" that only those people know, and run the 
   script like this:

      python scoreboard-publish.py contest.conf --update 10 --suffix super_secret_suffix

3. Once the contest is over, publish the final scoreboard:

      python scoreboard-publish.py contest.conf --suffix final

4. If you are using EWTeam, thaw the EWTeam scoreboard too:

      python scoreboard-publish.py contest.conf --thaw-ewteam

